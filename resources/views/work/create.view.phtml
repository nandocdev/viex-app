<div class="content-header">
   <div class="container-fluid">
      <div class="row mb-2">
         <div class="col-sm-6">
            <h1 class="m-0"><?= htmlspecialchars($pageTitle, ENT_QUOTES, 'UTF-8') ?></h1>
         </div>
      </div>
   </div>
</div>

<section class="content">
   <div class="container-fluid">
      <form action="<?= route('work.store') ?>" method="post">
         <?= csrf_field() ?>
         <div class="row">
            <!-- Columna para el formulario principal -->
            <div class="col-md-12">
               <div class="card card-primary">
                  <div class="card-header">
                     <h3 class="card-title">Información General</h3>
                  </div>
                  <div class="card-body">
                     <!-- Datos Comunes -->
                     <div class="form-group">
                        <label for="title">Título del Trabajo</label>
                        <input type="text" id="title" name="title" class="form-control" required>
                     </div>

                     <div class="form-group">
                        <label for="work_type_id">Tipo de Trabajo</label>
                        <select id="work_type_id" name="work_type_id" class="form-control" required>
                           <option value="" selected disabled>-- Seleccione un tipo --</option>
                           <?php foreach ($extra['workTypes'] as $type): ?>
                              <option value="<?= $type->id ?>"><?= htmlspecialchars($type->name, ENT_QUOTES, 'UTF-8') ?>
                              </option>
                           <?php endforeach; ?>
                        </select>
                     </div>

                     <!-- Contenedor para los campos dinámicos -->
                     <div id="work-details-container">

                        <!-- Sección para Proyecto de Extensión (ID 1) -->
                        <div id="details_1" class="work-details-section" style="display: none;">
                           <hr>
                           <h4>Detalles del Proyecto</h4>
                           <div class="form-group">
                              <label for="project_category">Categoría del Proyecto</label>
                              <select name="project_category" class="form-control">
                                 <option value="Institucional">Institucional</option>
                                 <option value="Unidad Académica">Unidad Académica</option>
                                 <option value="Servicio Social">Servicio Social</option>
                              </select>
                           </div>
                           <div class="form-group">
                              <label for="general_description">Descripción General</label>
                              <textarea name="general_description" class="form-control" rows="3"></textarea>
                           </div>
                           <!-- ... más campos de proyecto ... -->
                        </div>

                        <!-- Sección para Actividad de Extensión (ID 2) -->
                        <div id="details_2" class="work-details-section" style="display: none;">
                           <hr>
                           <h4>Detalles de la Actividad</h4>
                           <div class="form-group">
                              <label for="introduction">Introducción</label>
                              <textarea name="introduction" class="form-control" rows="3"></textarea>
                           </div>
                           <!-- ... más campos de actividad ... -->
                        </div>

                        <!-- ... más secciones para otros tipos de trabajo ... -->

                     </div>

                     <div class="row">
                        <div class="col-md-6">
                           <div class="form-group">
                              <label for="start_date">Fecha de Inicio</label>
                              <input type="date" id="start_date" name="start_date" class="form-control">
                           </div>
                        </div>
                        <div class="col-md-6">
                           <div class="form-group">
                              <label for="end_date">Fecha de Fin</label>
                              <input type="date" id="end_date" name="end_date" class="form-control">
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="card-footer">
                     <button type="submit" class="btn btn-primary">Crear Borrador del Trabajo</button>
                  </div>
               </div>
            </div>
         </div>
      </form>
   </div>
</section>

<!-- Lógica de JavaScript para el formulario dinámico -->
<script>
   document.addEventListener('DOMContentLoaded', function () {
      const workTypeSelect = document.getElementById('work_type_id');
      const sections = document.querySelectorAll('.work-details-section');

      workTypeSelect.addEventListener('change', function () {
         // Ocultar todas las secciones de detalles
         sections.forEach(function (section) {
            section.style.display = 'none';
         });

         // Mostrar la sección correspondiente al tipo seleccionado
         const selectedTypeId = this.value;
         if (selectedTypeId) {
            const selectedSection = document.getElementById('details_' + selectedTypeId);
            if (selectedSection) {
               selectedSection.style.display = 'block';
            }
         }
      });
   });
</script>